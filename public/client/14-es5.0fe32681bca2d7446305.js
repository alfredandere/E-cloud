!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],i=!0,o=!1,a=void 0;try{for(var r,c=t[Symbol.iterator]();!(i=(r=c.next()).done)&&(e.push(r.value),!n||e.length!==n);i=!0);}catch(s){o=!0,a=s}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}return e}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{cPR9:function(n,i,a){"use strict";a.r(i),a.d(i,"NotificationsModule",(function(){return Y}));var r,c=a("ofXK"),s=a("tyNb"),u=a("2Vo4"),l=a("pLZG"),b=a("nYR2"),f=a("3Pt+"),d=a("fXoL"),g=a("LRXf"),p=((r=function(){function t(n){e(this,t),this.http=n}return o(t,[{key:"getAll",value:function(t){return this.http.get("notifications/".concat(t,"/subscriptions"))}},{key:"updateUserSubscriptions",value:function(t,n){return this.http.put("notifications/".concat(t,"/subscriptions"),{selections:n})}}]),t}()).\u0275fac=function(t){return new(t||r)(d.Zb(g.a))},r.\u0275prov=d.Lb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),m=a("twBr"),h=a("i2dy"),v=a("kmQS"),y=a("N2vX"),P=a("bTqV"),w=a("Rd8u"),k=a("bSwM");function O(t,n){if(1&t){var e=d.Wb();d.Vb(0,"div",12),d.Vb(1,"div",13),d.Kc(2),d.Ub(),d.Vb(3,"mat-checkbox",14),d.cc("change",(function(t){d.xc(e);var i=n.$implicit,o=d.gc(3);return t?o.toggleAllRowsFor(i):null})),d.Ub(),d.Ub()}if(2&t){var i=n.$implicit,o=d.gc(3);d.Db(2),d.Lc(i),d.Db(1),d.mc("checked",o.allRowsSelectedFor(i))("indeterminate",o.someRowsSelectedFor(i)&&!o.allRowsSelectedFor(i))("disabled","browser"===i&&!o.supportsBrowserNotifications)}}function C(t,n){if(1&t&&(d.Tb(0),d.Ic(1,O,4,4,"div",11),d.Sb()),2&t){var e=d.gc(2);d.Db(1),d.mc("ngForOf",e.availableChannels)}}function x(t,n){if(1&t&&(d.Vb(0,"div",12),d.Qb(1,"mat-checkbox",17),d.Ub()),2&t){var e=n.$implicit;d.Db(1),d.mc("formControlName",e)}}function _(t,n){if(1&t&&(d.Vb(0,"div",15),d.Vb(1,"div",16),d.Kc(2),d.Ub(),d.Ic(3,x,2,1,"div",11),d.Ub()),2&t){var e=n.$implicit,i=n.last,o=d.gc(2);d.Hb("no-border",i),d.mc("formGroupName",e.notif_id),d.Db(2),d.Lc(e.name),d.Db(1),d.mc("ngForOf",o.availableChannels)}}function U(t,n){if(1&t&&(d.Vb(0,"div",5),d.Vb(1,"div",6),d.Vb(2,"div",7),d.Kc(3),d.Ub(),d.Ic(4,C,2,1,"ng-container",8),d.Ub(),d.Vb(5,"div",9),d.Ic(6,_,4,5,"div",10),d.Ub(),d.Ub()),2&t){var e=n.$implicit,i=n.first,o=d.gc();d.Db(3),d.Lc(e.group_name),d.Db(1),d.mc("ngIf",i),d.Db(1),d.mc("formGroup",o.form),d.Db(1),d.mc("ngForOf",e.notifications)}}var M,V,F=((M=function(){function n(t,i,o,a,r,c){e(this,n),this.route=t,this.api=i,this.currentUser=o,this.toast=a,this.cd=r,this.settings=c,this.availableChannels=[],this.loading$=new u.a(!1),this.supportsBrowserNotifications="Notification"in window,this.form=new f.l({})}return o(n,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe((function(n){t.groupedNotifications=n.api.grouped_notifications,t.availableChannels=n.api.available_channels,t.initialUserSelections=n.api.user_selections,t.groupedNotifications.forEach((function(n){n.notifications.forEach((function(n){return t.addNotifFormField(n.notif_id)}))}))}))}},{key:"addNotifFormField",value:function(t){var n=this,e=new f.l({});this.availableChannels.forEach((function(i){var o,a=null===(o=n.initialUserSelections.find((function(n){return n.notif_id===t})))||void 0===o?void 0:o.channels[i],r=new f.i({value:null!=a&&a,disabled:"browser"===i&&!n.supportsBrowserNotifications});"browser"===i&&"granted"!==Notification.permission&&r.valueChanges.pipe(Object(l.a)((function(t){return t}))).subscribe((function(t){"denied"===Notification.permission?(n.toast.open("Notifications blocked. Please enable them for this site from browser settings."),r.setValue(!1,{emitEvent:!1}),n.cd.markForCheck()):Notification.requestPermission().then((function(t){"granted"!==t&&(r.setValue(!1,{emitEvent:!1}),n.cd.markForCheck())}))})),e.addControl(i,r)})),this.form.addControl(t,e)}},{key:"toggleAllRowsFor",value:function(t){var n=!this.allRowsSelectedFor(t);Object.values(this.form.controls).forEach((function(e){e.controls[t].setValue(n),e.controls[t].markAsDirty()}))}},{key:"allRowsSelectedFor",value:function(t){return Object.values(this.form.controls).every((function(n){return!0===n.controls[t].value}))}},{key:"someRowsSelectedFor",value:function(t){return Object.values(this.form.controls).some((function(n){return!0===n.controls[t].value}))}},{key:"saveSettings",value:function(){var t=this;this.loading$.next(!0);var n=this.getPayload();this.api.updateUserSubscriptions(this.currentUser.get("id"),n).pipe(Object(b.a)((function(){return t.loading$.next(!1)}))).subscribe((function(){t.form.markAsPristine(),t.toast.open("Notification settings updated.")}))}},{key:"getPayload",value:function(){return Object.entries(this.form.controls).filter((function(n){var e=t(n,2);return e[0],e[1].dirty})).map((function(n){var e=t(n,2);return{notif_id:e[0],channels:e[1].value}}))}}]),n}()).\u0275fac=function(t){return new(t||M)(d.Pb(s.a),d.Pb(p),d.Pb(m.a),d.Pb(h.b),d.Pb(d.i),d.Pb(v.a))},M.\u0275cmp=d.Jb({type:M,selectors:[["notification-subscriptions"]],decls:7,vars:5,consts:[[1,"box-shadow",3,"menuPosition"],[1,"be-container"],[1,"table","material-panel",3,"ngSubmit"],["class","setting-group",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"setting-group"],[1,"row"],["trans","",1,"name-column","strong"],[4,"ngIf"],[3,"formGroup"],["class","row indent",3,"no-border","formGroupName",4,"ngFor","ngForOf"],["class","channel-column",4,"ngFor","ngForOf"],[1,"channel-column"],["trans","",1,"channel-name"],[3,"checked","indeterminate","disabled","change"],[1,"row","indent",3,"formGroupName"],["trans","",1,"name-column"],[3,"formControlName"]],template:function(t,n){1&t&&(d.Qb(0,"material-navbar",0),d.Vb(1,"div",1),d.Vb(2,"form",2),d.cc("ngSubmit",(function(){return n.saveSettings()})),d.Ic(3,U,7,4,"div",3),d.Vb(4,"button",4),d.hc(5,"async"),d.Kc(6,"Save Settings"),d.Ub(),d.Ub(),d.Ub()),2&t&&(d.mc("menuPosition",n.settings.get("vebto.navbar.defaultPosition")),d.Db(3),d.mc("ngForOf",n.groupedNotifications),d.Db(1),d.mc("disabled",d.ic(5,3,n.loading$)))},directives:[y.a,f.K,f.v,f.w,c.s,P.b,w.a,c.t,f.m,k.a,f.n,f.u,f.k],pipes:[c.b],styles:["[_nghost-%COMP%]{display:block;background-color:var(--be-background-alternative);min-height:100vh}.be-container[_ngcontent-%COMP%]{padding-top:35px;padding-bottom:35px}.table[_ngcontent-%COMP%]{border-radius:4px}.setting-group[_ngcontent-%COMP%]{margin-bottom:10px}.row[_ngcontent-%COMP%]{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);padding:10px}.row.no-border[_ngcontent-%COMP%]{border-bottom:none}.row.indent[_ngcontent-%COMP%]{padding-left:20px}.name-column[_ngcontent-%COMP%]{flex:1 1 auto}.strong[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;align-self:flex-end}.channel-name[_ngcontent-%COMP%]{margin-bottom:10px}.channel-column[_ngcontent-%COMP%]{width:75px;text-align:center;text-transform:capitalize}.submit-button[_ngcontent-%COMP%]{margin-top:15px}"],changeDetection:0}),M),N=a("JIr8"),S=a("5+tZ"),D=a("EY2u"),$=a("LRne"),j=((V=function(){function t(n,i,o){e(this,t),this.router=n,this.subscriptions=i,this.currentUser=o}return o(t,[{key:"resolve",value:function(t,n){var e=this;return this.subscriptions.getAll(+this.currentUser.get("id")).pipe(Object(N.a)((function(){return e.router.navigate(["/account/settings"]),D.a})),Object(S.a)((function(t){return t?Object($.a)(t):(e.router.navigate(["/account/settings"]),D.a)})))}}]),t}()).\u0275fac=function(t){return new(t||V)(d.Zb(s.g),d.Zb(p),d.Zb(m.a))},V.\u0275prov=d.Lb({token:V,factory:V.\u0275fac,providedIn:"root"}),V),A=a("f+iI"),I=a("OnlV"),R=a("WWJw");function K(t,n){if(1&t){var e=d.Wb();d.Vb(0,"li"),d.Vb(1,"button",4),d.cc("click",(function(){d.xc(e);var t=n.$implicit;return d.gc().selectPage(t)})),d.Kc(2),d.Ub(),d.Ub()}if(2&t){var i=n.$implicit,o=d.gc();d.Db(1),d.Hb("active",o.currentPage===i),d.mc("disabled",o.disabled),d.Db(1),d.Lc(i)}}var E,L,J,G,Z,B=((E=function(){function t(n){e(this,t),this.router=n,this.pageChanged=new d.o,this.disabled=!0}return o(t,[{key:"selectPage",value:function(t){this.currentPage!==t&&(this.currentPage=t,this.pageChanged.next(t),this.router.navigate([],{queryParams:{page:t},replaceUrl:!0}))}},{key:"nextPage",value:function(){var t=this.currentPage+1;this.selectPage(t<=this.numberOfPages?t:this.currentPage)}},{key:"prevPage",value:function(){var t=this.currentPage-1;this.selectPage(t>=1?t:this.currentPage)}},{key:"shouldHide",get:function(){return this.numberOfPages<2}},{key:"pagination",set:function(t){t&&(this.numberOfPages=t.last_page>10?10:t.last_page,this.numberOfPages>1&&(this.iterator=Array.from(Array(this.numberOfPages).keys()).map((function(t){return t+1})),this.currentPage=t.current_page))}}]),t}()).\u0275fac=function(t){return new(t||E)(d.Pb(s.g))},E.\u0275cmp=d.Jb({type:E,selectors:[["pagination-widget"]],hostVars:2,hostBindings:function(t,n){2&t&&d.Hb("hidden",n.shouldHide)},inputs:{disabled:"disabled",pagination:"pagination"},outputs:{pageChanged:"pageChanged"},decls:8,vars:3,consts:[[1,"page-numbers","unstyled-list"],["type","button","mat-button","","trans","",1,"prev",3,"disabled","click"],[4,"ngFor","ngForOf"],["type","button","mat-button","","trans","",1,"next",3,"disabled","click"],["type","button","mat-flat-button","","color","gray",1,"page-number-button",3,"disabled","click"]],template:function(t,n){1&t&&(d.Vb(0,"ul",0),d.Vb(1,"li"),d.Vb(2,"button",1),d.cc("click",(function(){return n.prevPage()})),d.Kc(3,"Previous"),d.Ub(),d.Ub(),d.Ic(4,K,3,4,"li",2),d.Vb(5,"li"),d.Vb(6,"button",3),d.cc("click",(function(){return n.nextPage()})),d.Kc(7,"Next"),d.Ub(),d.Ub(),d.Ub()),2&t&&(d.Db(2),d.mc("disabled",n.disabled),d.Db(2),d.mc("ngForOf",n.iterator),d.Db(2),d.mc("disabled",n.disabled))},directives:[P.b,w.a,c.s],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-wrap:wrap;width:100%}li[_ngcontent-%COMP%]{margin:0 3px 6px}.page-number-button[_ngcontent-%COMP%]{width:40px;height:40px;min-width:40px;line-height:40px;padding:0}.active[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.next[_ngcontent-%COMP%], .prev[_ngcontent-%COMP%]{color:var(--be-accent-default)}"],changeDetection:0}),E),H=[{path:"",component:(L=function(){function t(n,i,o,a){e(this,t),this.settings=n,this.notifications=i,this.breakpoints=o,this.route=a,this.pagination$=new u.a(null)}return o(t,[{key:"ngOnInit",value:function(){this.loadPage(this.route.snapshot.queryParams.page||1)}},{key:"loadPage",value:function(t){var n=this;this.notifications.load({page:t,perPage:25}).subscribe((function(t){n.pagination$.next(t.pagination)}))}},{key:"markAsRead",value:function(t){this.pagination$.value.data.find((function(n){return n.id===t.id})).read_at=t.read_at}}]),t}(),L.\u0275fac=function(t){return new(t||L)(d.Pb(v.a),d.Pb(A.a),d.Pb(I.a),d.Pb(s.a))},L.\u0275cmp=d.Jb({type:L,selectors:[["notification-page"]],decls:8,vars:13,consts:[[3,"menuPosition"],[1,"be-container"],[3,"notifications","compact","markedAsRead"],[3,"pagination","disabled","pageChanged"]],template:function(t,n){var e;1&t&&(d.Qb(0,"material-navbar",0),d.Vb(1,"div",1),d.Vb(2,"notification-list",2),d.cc("markedAsRead",(function(t){return n.markAsRead(t)})),d.hc(3,"async"),d.hc(4,"async"),d.Ub(),d.Vb(5,"pagination-widget",3),d.cc("pageChanged",(function(t){return n.loadPage(t)})),d.hc(6,"async"),d.hc(7,"async"),d.Ub(),d.Ub()),2&t&&(d.mc("menuPosition",n.settings.get("vebto.navbar.defaultPosition")),d.Db(2),d.mc("notifications",null==(e=d.ic(3,5,n.pagination$))?null:e.data)("compact",d.ic(4,7,n.breakpoints.isMobile$)),d.Db(3),d.mc("pagination",d.ic(6,9,n.pagination$))("disabled",d.ic(7,11,n.notifications.loading$)))},directives:[y.a,R.a,B],pipes:[c.b],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background-color:var(--be-background-alternative)}.be-container[_ngcontent-%COMP%]{padding-top:25px;padding-bottom:25px}pagination-widget[_ngcontent-%COMP%]{margin-top:35px}"],changeDetection:0}),L)},{path:"settings",component:F,resolve:{api:j},data:{permissions:["notification.subscribe"]}}],T=((J=function t(){e(this,t)}).\u0275mod=d.Nb({type:J}),J.\u0275inj=d.Mb({factory:function(t){return new(t||J)},imports:[[s.k.forChild(H)],s.k]}),J),W=a("MKyN"),X=a("CXWK"),q=a("gFpt"),Q=a("6rvT"),z=((Z=function t(){e(this,t)}).\u0275mod=d.Nb({type:Z}),Z.\u0275inj=d.Mb({factory:function(t){return new(t||Z)},imports:[[c.c,P.c,Q.a]]}),Z),Y=((G=function t(){e(this,t)}).\u0275mod=d.Nb({type:G}),G.\u0275inj=d.Mb({factory:function(t){return new(t||G)},imports:[[c.c,f.o,f.E,T,q.a,W.a,X.a,z,Q.a,k.b,P.c]]}),G)}}])}();
//# sourceMappingURL=14-es5.0fe32681bca2d7446305.js.map